
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Recipieceï¼ãŠæ°—ã«å…¥ã‚Šã®ãƒ¬ã‚·ãƒ”ã‚’ã‚«ãƒ¼ãƒ‰ã«</title>
  <style>
    :root{
      --w: 100mm;
      --h: 148mm;
      --pad: 6mm;
      --safe: 2mm;           /* â˜…è¦‹åˆ‡ã‚Œé˜²æ­¢ã®å®‰å…¨ãƒãƒ¼ã‚¸ãƒ³ */
      --bottom-gap: 5mm;     /* ä¸‹ã‹ã‚‰0.5cm */
      --dash: 1px dotted #000;
      --title-pt: 9pt;
      --ing-pt: 9pt;
      --v-gap: 4pt;
    }

    body{
      font-family:"Yu Gothic","Hiragino Kaku Gothic ProN","Noto Sans JP",sans-serif;
      margin:0;
      padding:20px;
      background:#f2f2f2;
    }

    /* ===== HEADER / LOGO ===== */
    .app-header{ width:100%; margin:0 0 12px 0; }
    .app-logo{ height:28px; width:auto; display:block; }

    /* ===== MAIN LAYOUT (preview left / form right) ===== */
    .app-main{
      display:flex;
      gap:20px;
      align-items:flex-start;
    }

    /* ===== PREVIEW ===== */
    .preview{ display:flex; gap:20px; }

    .page{
      width:var(--w);
      height:var(--h);
      background:#fff;
      border:1px solid #bbb;
      /* â˜…ä¸Šä¸‹ã®è¦‹åˆ‡ã‚Œé˜²æ­¢ï¼šä¸Šãƒ»ä¸‹ã«å®‰å…¨ãƒãƒ¼ã‚¸ãƒ³ã‚’è¿½åŠ  */
      padding:calc(var(--pad) + var(--safe)) var(--pad) calc(var(--bottom-gap) + var(--safe)) var(--pad);
      box-sizing:border-box;
      overflow:hidden; /* å°åˆ·æ™‚ã®ã¯ã¿å‡ºã—ã‚’ç¢ºå®Ÿã«é˜²ã */
    }

    .front-layout, .back-layout{
      height:100%;
      display:flex;
      flex-direction:column;
      min-height:0;
    }

    .title{
      text-align:center;
      font-weight:800;
      font-size:var(--title-pt);
      line-height:1.25; /* â˜…ä¸Šã®è¦‹åˆ‡ã‚Œé˜²æ­¢ */
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      margin:0 0 var(--v-gap) 0;
      flex:0 0 auto;
    }

    .sep{
      border-bottom:2px dashed #000;
      margin:0 0 var(--v-gap) 0;
      flex:0 0 auto;
    }

    /* ===== PHOTO (max 6cm height) ===== */
    .photo{
      width:100%;
      height:60mm;            /* â˜…ç¸¦6cmä»¥å†…ã«å›ºå®šï¼ˆå¸¸ã«åã¾ã‚‹ï¼‰ */
      max-height:60mm;
      border:1px solid #777;
      background:#e6e6e6;
      position:relative;
      overflow:hidden;
      margin:0 0 var(--v-gap) 0;
      flex:0 0 auto;
    }
    .photo img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:none;
    }
    .photo-ph{
      position:absolute; inset:0;
      display:flex; align-items:center; justify-content:center;
      color:#fff; font-weight:800; font-size:10pt;
      text-shadow:0 1px 2px rgba(0,0,0,.35);
    }

    /* ===== INGREDIENTS ===== */
    .ing-wrap{
      padding:4pt 2pt 8pt 2pt; /* â˜…ä¸‹ã‚’åšã‚ã«ã—ã¦æœ€çµ‚è¡Œã®è¦‹åˆ‡ã‚Œé˜²æ­¢ */
      box-sizing:border-box;
      overflow:hidden;
      flex:1 1 auto;
      min-height:0;
    }

    .ing-head{
      text-align:center;
      font-weight:800;
      font-size:9pt;
      margin:0 0 4pt 0;
      line-height:1.2;
    }
    .ing-sep{ border-bottom:2px dashed #000; margin:0 0 4pt 0; }

    table.ing-table{
      width:100%;
      border-collapse:collapse;
      font-size:var(--ing-pt);
      line-height:1.35;
    }
    .ing-table td{ padding:1.2pt 0; vertical-align:baseline; }

    /* ææ–™å â€¦â€¦â€¦ åˆ†é‡ï¼ˆç‚¹ç·šã§ç¹‹ãï¼‰ */
    .ing-row-view{
      display:flex;
      align-items:baseline;
      gap:4pt;
      min-width:0;
    }
    .ing-name{
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      min-width:0;
      max-width:60%;
    }
    .ing-dots{
      flex:1 1 auto;
      border-bottom:var(--dash);
      height:0;
      /* transform ã‚’ä½¿ã‚ãšè¦‹åˆ‡ã‚Œãƒªã‚¹ã‚¯ã‚’æ¸›ã‚‰ã™ */
      margin-bottom:2pt;
    }
    .ing-amount{
      white-space:nowrap;
      text-align:right;
      flex:0 0 auto;
      min-width:18mm;
    }

    /* è¦‹å‡ºã—ï¼ˆèª¿å‘³æ–™ãªã©ï¼‰ */
    .ing-header{
      font-weight:800;
      font-size:8.5pt;
      padding:4pt 0 2pt 0;
    }

    /* ===== BACK / STEPS ===== */
    .steps-wrap{
      overflow:hidden;
      flex:1 1 auto;
      min-height:0;
      padding-bottom:6pt; /* â˜…ä¸‹ã®è¦‹åˆ‡ã‚Œé˜²æ­¢ */
      box-sizing:border-box;
    }

    .step-list{
      list-style:none;
      padding:0;
      margin:0;
      font-size:11.5pt;
      line-height:1.5;
    }

    .step-item{
      display:flex;
      gap:2.5mm;
      margin-bottom:2.4mm;
      align-items:flex-start;
    }

    .step-num{
      width:5mm;
      height:5mm;
      background:#000;
      color:#fff;
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:800;
      font-size:10pt;          /* â˜…æ•°å­—ã‚µã‚¤ã‚ºå›ºå®š */
      line-height:1;           /* â˜…è¦‹ãŸç›®ã®ãƒãƒ©ã¤ãé˜²æ­¢ */
      font-variant-numeric: tabular-nums; /* â˜…æ¡å¹…å›ºå®šï¼ˆ1ãŒå°ã•ãè¦‹ãˆã‚‹ã®ã‚’è»½æ¸›ï¼‰ */
      border-radius:1px;
      flex:0 0 auto;
      margin-top:0.4mm;
    }

    /* ===== FORM ===== */
    form{
      width:420px;
      background:#fff;
      border:1px solid #ddd;
      border-radius:12px;
      padding:14px;
      box-shadow:0 4px 16px rgba(0,0,0,.06);
    }
    label{ font-weight:700; font-size:13px; margin-top:10px; display:block; }
    input,textarea{ width:100%; box-sizing:border-box; font-size:14px; }
    textarea{ resize:vertical; }

    .ing-row{
      display:grid;
      grid-template-columns: 1fr 120px 36px;
      gap:6px;
      margin-top:6px;
    }
    .ing-row button{ width:36px; }

    .step-input{
      display:flex;
      gap:6px;
      margin-top:6px;
    }
    .step-input input{ flex:1; }
    .step-input button{ width:36px; }

    @media print{
      body{ background:#fff; padding:0; margin:0; }
      .app-header{ display:none !important; }
      form{ display:none !important; }

      /* å°åˆ·æ™‚ï¼šè¡¨â†’è£ã§2ãƒšãƒ¼ã‚¸ */
      .preview{ display:block !important; }
      .page{
        border:none !important;
        display:block !important;
        width:100mm !important;
        height:148mm !important;
        page-break-after:always !important;
        break-after:page !important;
      }
      .page:last-child{
        page-break-after:auto !important;
        break-after:auto !important;
      }
      @page{ size:100mm 148mm; margin:0; }
    }
  </style>
</head>
<body>

  <header class="app-header">
    <img src="logo_Recipiece.png" alt="Recipiece" class="app-logo">
  </header>

  <div class="app-main">

    <div class="preview">
      <!-- FRONT -->
      <div class="page">
        <div class="front-layout">
          <div class="title" id="frontTitle">ãƒ¬ã‚·ãƒ”ã‚¿ã‚¤ãƒˆãƒ«</div>
          <div class="sep"></div>

          <div class="photo">
            <img id="frontImg" alt="">
            <div class="photo-ph" id="ph">â€»æ–™ç†ã®å†™çœŸ</div>
          </div>

          <div class="ing-wrap" id="frontIngWrap">
            <div class="ing-head">ææ–™ <span id="frontServ">â—‹äººåˆ†</span></div>
            <div class="ing-sep"></div>
            <table class="ing-table" id="frontIngTable"></table>
          </div>
        </div>
      </div>

      <!-- BACK -->
      <div class="page">
        <div class="back-layout">
          <div class="title">ä½œã‚Šæ–¹</div>
          <div class="sep"></div>
          <div class="steps-wrap" id="stepsWrap">
            <ul class="step-list" id="backSteps"></ul>
          </div>
        </div>
      </div>
    </div>

    <form>
      <label>ã‚¿ã‚¤ãƒˆãƒ«</label>
      <input id="title" placeholder="ä¾‹ï¼šã‹ã¼ã¡ã‚ƒã®ç…®ç‰©">

      <label>ç”»åƒ</label>
      <input type="file" id="imgUp" accept="image/*">

      <label>äººæ•°</label>
      <div style="display:flex;gap:6px;align-items:center;">
        <input id="serv" type="number" min="1" step="1" style="width:80px;">
        <span>äººåˆ†</span>
      </div>

      <label>ææ–™ï¼ˆææ–™ï¼åˆ†é‡ï¼‰</label>
      <div id="ingredients"></div>
      <div style="display:flex; gap:8px; margin-top:8px;">
        <button type="button" onclick="addIngredient()">ï¼‹ææ–™</button>
        <button type="button" onclick="addIngHeader()">ï¼‹è¦‹å‡ºã—</button>
      </div>

      <label>ä½œã‚Šæ–¹</label>
      <div id="steps"></div>
      <button type="button" onclick="addStep()">ï¼‹å·¥ç¨‹è¿½åŠ </button>

      <button type="button" onclick="window.print()" style="margin-top:10px;">ğŸ–¨ å°åˆ·</button>
    </form>

  </div>

<script>
function addIngredient(name="", amount=""){
  const row=document.createElement("div");
  row.className="ing-row";
  row.dataset.type="item";

  const n=document.createElement("input");
  n.placeholder="ææ–™";
  n.value=name;
  n.oninput=update;

  const a=document.createElement("input");
  a.placeholder="åˆ†é‡";
  a.value=amount;
  a.oninput=update;

  const b=document.createElement("button");
  b.type="button";
  b.textContent="âˆ’";
  b.onclick=()=>{row.remove(); update();};

  row.append(n,a,b);
  ingredients.append(row);
}

function addIngHeader(text=""){
  const row=document.createElement("div");
  row.className="ing-row";
  row.dataset.type="header";

  const n=document.createElement("input");
  n.placeholder="è¦‹å‡ºã—ï¼ˆä¾‹ï¼šèª¿å‘³æ–™ï¼‰";
  n.value=text;
  n.oninput=update;

  const dummy=document.createElement("div");

  const b=document.createElement("button");
  b.type="button";
  b.textContent="âˆ’";
  b.onclick=()=>{row.remove(); update();};

  row.append(n,dummy,b);
  ingredients.append(row);
}

function addStep(v=""){
  const d=document.createElement("div");
  d.className="step-input";

  const i=document.createElement("input");
  i.value=v;
  i.placeholder="å·¥ç¨‹ã‚’å…¥åŠ›";
  i.oninput=update;

  const b=document.createElement("button");
  b.type="button";
  b.textContent="âˆ’";
  b.onclick=()=>{d.remove(); update();};

  d.append(i,b);
  steps.append(d);
}

function autoShrinkIngredients(){
  const wrap=document.getElementById("frontIngWrap");
  const head=wrap.querySelector(".ing-head");
  const sep=wrap.querySelector(".ing-sep");
  const table=document.getElementById("frontIngTable");

  let size=9.0;
  table.style.fontSize=size+"pt";

  const available = wrap.clientHeight - head.offsetHeight - sep.offsetHeight - 12; // safety margin

  while(table.scrollHeight > available && size > 6.0){
    size -= 0.5;
    table.style.fontSize = size + "pt";
  }
}

function autoShrinkSteps(){
  const wrap = document.getElementById("stepsWrap");
  const list = document.getElementById("backSteps");
  if(!wrap || !list) return;

  let size = 11.5; // initial
  list.style.fontSize = size + "pt";

  const available = wrap.clientHeight - 12; // safety margin

  while(list.scrollHeight > available && size > 8.0){
    size -= 0.5;
    list.style.fontSize = size + "pt";
  }
}

function update(){
  frontTitle.textContent = title.value || "ãƒ¬ã‚·ãƒ”ã‚¿ã‚¤ãƒˆãƒ«";
  frontServ.textContent  = serv.value ? (serv.value + "äººåˆ†") : "â—‹äººåˆ†";

  // ingredients preview
  frontIngTable.innerHTML = "";
  [...ingredients.children].forEach(row=>{
    const type = row.dataset.type || "item";
    const inputs=row.querySelectorAll("input");

    if(type === "header"){
      const label = (inputs[0]?.value||"").trim();
      if(!label) return;
      frontIngTable.insertAdjacentHTML("beforeend",
        `<tr><td colspan="3" class="ing-header">${escapeHtml(label)}</td></tr>`
      );
      return;
    }

    const name = (inputs[0]?.value||"").trim();
    const amt  = (inputs[1]?.value||"").trim();
    if(!name && !amt) return;

    frontIngTable.insertAdjacentHTML("beforeend",
      `<tr><td colspan="3">
        <div class="ing-row-view">
          <span class="ing-name">${escapeHtml(name)}</span>
          <span class="ing-dots"></span>
          <span class="ing-amount">${escapeHtml(amt)}</span>
        </div>
      </td></tr>`
    );
  });

  // steps
  backSteps.innerHTML = "";
  [...steps.querySelectorAll("input")].forEach((i,n)=>{
    const v=i.value.trim();
    if(!v) return;
    backSteps.insertAdjacentHTML("beforeend",
      `<li class="step-item"><div class="step-num">${n+1}</div><div>${escapeHtml(v)}</div></li>`
    );
  });

  autoShrinkIngredients();
  autoShrinkSteps();
}

function escapeHtml(str){
  return str.replace(/[&<>"']/g, (m) => ({
    "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"
  }[m]));
}

imgUp.onchange = (e) => {
  const f=e.target.files[0];
  if(!f) return;
  const r=new FileReader();
  r.onload = (ev) => {
    frontImg.src = ev.target.result;
    frontImg.style.display = "block";
    ph.style.display = "none";
  };
  r.readAsDataURL(f);
};

title.oninput = serv.oninput = update;

window.addEventListener("resize", () => {
  autoShrinkIngredients();
  autoShrinkSteps();
});

// initial rows
addIngredient(); addIngredient();
addStep(); addStep();
update();
</script>

</body>
</html>
