<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Recipieceï¼ãŠæ°—ã«å…¥ã‚Šã®ãƒ¬ã‚·ãƒ”ã‚’ã‚«ãƒ¼ãƒ‰ã«</title>

  <style>
    :root{
      --w: 100mm;
      --h: 148mm;
      --pad: 6mm;
      --bottom-gap: 5mm;
      --dash: 2px dashed #000;
      --title-pt: 9pt;
      --ing-pt: 9pt;
      --v-gap: 4pt;
    }

    body{
      font-family:"Yu Gothic","Hiragino Kaku Gothic ProN","Noto Sans JP",sans-serif;
      margin:0;
      padding:20px;
      background:#f2f2f2;
    }

    .app-header{margin-bottom:12px;}
    .app-logo{height:28px;}

    .app-main{display:flex;gap:20px;align-items:flex-start;}

    .preview{display:flex;gap:20px;}

    .page{
      width:var(--w);
      height:var(--h);
      background:#fff;
      border:1px solid #bbb;
      padding:var(--pad) var(--pad) var(--bottom-gap) var(--pad);
      box-sizing:border-box;
      overflow:hidden;
    }

    .front-layout,.back-layout{
      height:100%;
      display:flex;
      flex-direction:column;
      min-height:0;
    }

    .title{
      text-align:center;
      font-weight:800;
      font-size:var(--title-pt);
      margin-bottom:var(--v-gap);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .sep{border-bottom:var(--dash);margin-bottom:var(--v-gap);}

    .photo{
      aspect-ratio:4/3;
      border:1px solid #777;
      background:#e6e6e6;
      margin-bottom:var(--v-gap);
      position:relative;
    }
    .photo img{width:100%;height:100%;object-fit:cover;display:none;}
    .photo-ph{
      position:absolute;inset:0;
      display:flex;align-items:center;justify-content:center;
      color:#fff;font-weight:800;
    }

    .ing-wrap{
      flex:1;
      overflow:hidden;
      padding:3pt 2pt;
    }

    .ing-head{text-align:center;font-weight:800;font-size:9pt;margin-bottom:4pt;}
    .ing-sep{border-bottom:var(--dash);margin-bottom:4pt;}

    table.ing-table{
      width:100%;
      border-collapse:collapse;
      font-size:var(--ing-pt);
      line-height:1.35;
    }
    .ing-table td{padding:1pt 0;vertical-align:top;}
    .ing-name{width:65%;}
    .ing-amount{width:35%;text-align:right;}

    .ing-header{
      font-weight:800;
      font-size:8.5pt;
      padding:3pt 0 2pt 0;
    }

    .step-list{list-style:none;padding:0;margin:0;font-size:11.5pt;line-height:1.5;}
    .step-item{display:flex;gap:2.5mm;margin-bottom:2.4mm;}
    .step-num{
      width:5mm;height:5mm;background:#000;color:#fff;
      display:flex;align-items:center;justify-content:center;
      font-weight:800;font-size:10pt;
    }

    form{
      width:420px;
      background:#fff;
      border:1px solid #ddd;
      border-radius:12px;
      padding:14px;
    }

    label{font-weight:700;font-size:13px;margin-top:10px;display:block;}
    input{width:100%;font-size:14px;}

    .ing-row{
      display:grid;
      grid-template-columns: 1fr 120px 36px;
      gap:6px;
      margin-top:6px;
    }

    .step-input{display:flex;gap:6px;margin-top:6px;}

    @media print{
      body{padding:0;background:#fff;}
      .app-header,form{display:none;}
      .preview{display:block;}
      .page{page-break-after:always;border:none;}
      .page:last-child{page-break-after:auto;}
      @page{size:100mm 148mm;margin:0;}
    }
  </style>
</head>

<body>

<header class="app-header">
  <img src="logo_Recipiece.png" alt="Recipiece" class="app-logo">
</header>

<div class="app-main">

<div class="preview">
  <div class="page">
    <div class="front-layout">
      <div class="title" id="frontTitle">ãƒ¬ã‚·ãƒ”ã‚¿ã‚¤ãƒˆãƒ«</div>
      <div class="sep"></div>

      <div class="photo">
        <img id="frontImg">
        <div class="photo-ph" id="ph">â€»æ–™ç†ã®å†™çœŸ</div>
      </div>

      <div class="ing-wrap" id="frontIngWrap">
        <div class="ing-head">ææ–™ <span id="frontServ">â—‹äººåˆ†</span></div>
        <div class="ing-sep"></div>
        <table class="ing-table" id="frontIngTable"></table>
      </div>
    </div>
  </div>

  <div class="page">
    <div class="back-layout">
      <div class="title">ä½œã‚Šæ–¹</div>
      <div class="sep"></div>
      <ul class="step-list" id="backSteps"></ul>
    </div>
  </div>
</div>

<form>
  <label>ã‚¿ã‚¤ãƒˆãƒ«</label>
  <input id="title">

  <label>ç”»åƒ</label>
  <input type="file" id="imgUp">

  <label>äººæ•°</label>
  <div style="display:flex;gap:6px;align-items:center;">
    <input id="serv" type="number" style="width:80px;">
    <span>äººåˆ†</span>
  </div>

  <label>ææ–™</label>
  <div id="ingredients"></div>
  <button type="button" onclick="addIngredient()">ï¼‹ææ–™</button>
  <button type="button" onclick="addIngHeader()">ï¼‹è¦‹å‡ºã—</button>

  <label>ä½œã‚Šæ–¹</label>
  <div id="steps"></div>
  <button type="button" onclick="addStep()">ï¼‹å·¥ç¨‹</button>

  <button type="button" onclick="window.print()">ğŸ–¨ å°åˆ·</button>
</form>

</div>

<script>
function addIngredient(){
  const r=document.createElement("div");
  r.className="ing-row";
  r.dataset.type="item";
  r.innerHTML='<input placeholder="ææ–™"><input placeholder="åˆ†é‡"><button>âˆ’</button>';
  r.querySelector("button").onclick=()=>{r.remove();update();}
  r.querySelectorAll("input").forEach(i=>i.oninput=update);
  ingredients.append(r);
}

function addIngHeader(){
  const r=document.createElement("div");
  r.className="ing-row";
  r.dataset.type="header";
  r.innerHTML='<input placeholder="è¦‹å‡ºã—"><div></div><button>âˆ’</button>';
  r.querySelector("button").onclick=()=>{r.remove();update();}
  r.querySelector("input").oninput=update;
  ingredients.append(r);
}

function addStep(){
  const d=document.createElement("div");
  d.className="step-input";
  d.innerHTML='<input><button>âˆ’</button>';
  d.querySelector("button").onclick=()=>{d.remove();update();}
  d.querySelector("input").oninput=update;
  steps.append(d);
}

function update(){
  frontTitle.textContent=title.value||"ãƒ¬ã‚·ãƒ”ã‚¿ã‚¤ãƒˆãƒ«";
  frontServ.textContent=serv.value?serv.value+"äººåˆ†":"â—‹äººåˆ†";

  frontIngTable.innerHTML="";
  [...ingredients.children].forEach(r=>{
    const t=r.dataset.type;
    const i=r.querySelectorAll("input");
    if(t==="header"){
      if(i[0].value)
        frontIngTable.innerHTML+=`<tr><td colspan="2" class="ing-header">${i[0].value}</td></tr>`;
    }else{
      if(i[0].value||i[1].value)
        frontIngTable.innerHTML+=`<tr><td>${i[0].value}</td><td class="ing-amount">${i[1].value}</td></tr>`;
    }
  });

  backSteps.innerHTML="";
  [...steps.querySelectorAll("input")].forEach((i,n)=>{
    if(i.value)
      backSteps.innerHTML+=`<li class="step-item"><div class="step-num">${n+1}</div><div>${i.value}</div></li>`;
  });
}

imgUp.onchange=e=>{
  const f=e.target.files[0];
  if(!f)return;
  const r=new FileReader();
  r.onload=ev=>{
    frontImg.src=ev.target.result;
    frontImg.style.display="block";
    ph.style.display="none";
  };
  r.readAsDataURL(f);
};

addIngredient();addIngredient();
addStep();addStep();
update();
</script>

</body>
</html>
