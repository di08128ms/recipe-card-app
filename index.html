
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Recipieceï¼ãŠæ°—ã«å…¥ã‚Šã®ãƒ¬ã‚·ãƒ”ã‚’ã‚«ãƒ¼ãƒ‰ã«</title>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <style>
    :root{
      --w: 100mm;
      --h: 148mm;
      --pad: 6mm;
      --bottom-gap: 5mm; /* ä¸‹ã‹ã‚‰0.5cm */
      --dash: 2px dashed #000;
      --title-pt: 9pt;
      --ing-pt: 9pt;
      --v-gap: 4pt;
    }

    body{
      font-family:"Yu Gothic","Hiragino Kaku Gothic ProN","Noto Sans JP",sans-serif;
      margin:0;
      padding:20px;
      background:#f2f2f2;
    }

    /* ===== HEADER / LOGO ===== */
    .app-header{
      width:100%;
      margin:0 0 12px 0;
    }
    .app-logo{
      height:28px; /* 24ã€œ32pxã§å¥½ã¿èª¿æ•´OK */
      width:auto;
      display:block;
    }

    /* ===== MAIN LAYOUT (preview left / form right) ===== */
    .app-main{
      display:flex;
      gap:20px;
      align-items:flex-start;
    }

    /* ===== PREVIEW ===== */
    .preview{display:flex;gap:20px;}

    .page{
      width:var(--w);
      height:var(--h);
      background:#fff;
      border:1px solid #bbb;
      padding:var(--pad) var(--pad) var(--bottom-gap) var(--pad); /* â˜…ä¸‹ã ã‘5mm */
      box-sizing:border-box;
      overflow:hidden;
    }

    /* Front uses flex to eliminate dead space */
    .front-layout{
      height:100%;
      display:flex;
      flex-direction:column;
      min-height:0;
    }

    .title{
      text-align:center;
      font-weight:800;
      font-size:var(--title-pt);
      line-height:1.15;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      margin:0 0 var(--v-gap) 0;
      flex: 0 0 auto;
    }
    .sep{
      border-bottom:var(--dash);
      margin:0 0 var(--v-gap) 0;
      flex: 0 0 auto;
    }

    .photo{
      width:100%;
      aspect-ratio:4/3;
      border:1px solid #777;
      background:#e6e6e6;
      position:relative;
      overflow:hidden;
      margin:0 0 var(--v-gap) 0;
      flex: 0 0 auto;
    }
    .photo img{width:100%;height:100%;object-fit:cover;display:none;}
    .photo-ph{
      position:absolute;inset:0;
      display:flex;align-items:center;justify-content:center;
      color:#fff;font-weight:800;font-size:10pt;
      text-shadow:0 1px 2px rgba(0,0,0,.35);
    }

    /* Ingredients fills remaining height */
    .ing-wrap{
      padding:4pt 2pt 3pt 2pt; /* â˜…ä¸‹ã«å°‘ã—ä½™ç™½ã‚’è¶³ã—ã¦è¦‹åˆ‡ã‚Œé˜²æ­¢ */
      box-sizing:border-box;
      overflow:hidden;
      flex: 1 1 auto;
      min-height:0;
    }
    .ing-head{
      text-align:center;
      font-weight:800;
      font-size:9pt;
      margin:0 0 4pt 0;
      line-height:1.1;
    }
    .ing-sep{border-bottom:var(--dash);margin:0 0 4pt 0;}

    table.ing-table{
      width:100%;
      border-collapse:collapse;
      font-size:var(--ing-pt);
      line-height:1.35;
    }
    .ing-table td{padding:1pt 0;white-space:nowrap;vertical-align:top;}
    .ing-name{width:65%;overflow:hidden;text-overflow:ellipsis;padding-right:4pt;}
    .ing-amount{width:35%;text-align:right;}

    /* Back */
    .back-layout{
      height:100%;
      display:flex;
      flex-direction:column;
      min-height:0;
    }
    .step-list{list-style:none;padding:0;margin:0;font-size:11.5pt;line-height:1.5;}
    .step-item{display:flex;gap:2.5mm;margin-bottom:2.4mm;align-items:flex-start;}
    .step-num{
      width:5mm;height:5mm;background:#000;color:#fff;
      display:flex;align-items:center;justify-content:center;
      font-weight:800;font-size:10pt;flex:0 0 auto;
      border-radius:1px;margin-top:0.4mm;
    }
    .steps-wrap{
      overflow:hidden;
      flex: 1 1 auto;
      min-height:0;
    }

    /* ===== FORM ===== */
    form{
      width:420px;background:#fff;border:1px solid #ddd;
      border-radius:12px;padding:14px;
      box-shadow:0 4px 16px rgba(0,0,0,.06);
    }
    label{font-weight:700;font-size:13px;margin-top:10px;display:block;}
    input,textarea{width:100%;box-sizing:border-box;font-size:14px;}
    textarea{resize:vertical;}

    .ing-row{
      display:grid;
      grid-template-columns: 1fr 120px 36px;
      gap:6px;
      margin-top:6px;
    }
    .ing-row button{width:36px;}
    .step-input{display:flex;gap:6px;margin-top:6px;}
    .step-input input{flex:1;}
    .step-input button{width:36px;}

    @media print{
      body{background:#fff;padding:0;margin:0;}
      .app-header{display:none !important;} /* â˜…å°åˆ·ã§ã¯ãƒ­ã‚´éè¡¨ç¤º */
      form{display:none !important;}

      /* å°åˆ·æ™‚ã ã‘æ¨ªä¸¦ã³ã‚’è§£é™¤ã—ã¦ç¸¦ã«ç©ã‚€ï¼ˆ=è¡¨â†’è£ã§2ãƒšãƒ¼ã‚¸ï¼‰ */
      .preview{display:block !important;}
      .page{
        border:none !important;
        display:block !important;
        width:100mm !important;
        height:148mm !important;
        page-break-after:always !important;
        break-after:page !important;
      }
      .page:last-child{
        page-break-after:auto !important;
        break-after:auto !important;
      }
      @page{size:100mm 148mm;margin:0;}
    }
  </style>
</head>
<body>

  <!-- ãƒ­ã‚´ï¼ˆHTMLãƒ•ã‚¡ã‚¤ãƒ«ã¨åŒã˜ãƒ•ã‚©ãƒ«ãƒ€ã« logo_Recipiece.png ã‚’ç½®ã„ã¦ãã ã•ã„ï¼‰ -->
  <header class="app-header">
    <img src="logo_Recipiece.png" alt="Recipiece" class="app-logo">
  </header>

  <!-- ã“ã“ã‹ã‚‰ãŒæ¨ªä¸¦ã³ï¼ˆå·¦ï¼šãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ / å³ï¼šå…¥åŠ›ï¼‰ -->
  <div class="app-main">

    <div class="preview">
      <!-- FRONT -->
      <div class="page">
        <div class="front-layout">
          <div class="title" id="frontTitle">ãƒ¬ã‚·ãƒ”ã‚¿ã‚¤ãƒˆãƒ«</div>
          <div class="sep"></div>

          <div class="photo">
            <img id="frontImg" alt="">
            <div class="photo-ph" id="ph">â€»æ–™ç†ã®å†™çœŸ</div>
          </div>

          <div class="ing-wrap" id="frontIngWrap">
            <div class="ing-head">ææ–™ <span id="frontServ">â—‹äººåˆ†</span></div>
            <div class="ing-sep"></div>
            <table class="ing-table" id="frontIngTable"></table>
          </div>
        </div>
      </div>

      <!-- BACK -->
      <div class="page">
        <div class="back-layout">
          <div class="title">ä½œã‚Šæ–¹</div>
          <div class="sep"></div>
          <div class="steps-wrap">
            <ul class="step-list" id="backSteps"></ul>
          </div>
        </div>
      </div>
    </div>

    <form>
      <label>ã‚¿ã‚¤ãƒˆãƒ«</label>
      <input id="title" placeholder="ä¾‹ï¼šè±†è…ã¨æ˜¥é›¨ã®ä¸­è¯é¢¨ç…®è¾¼ã¿">

      <label>ç”»åƒ</label>
      <input type="file" id="imgUp" accept="image/*">

      <label>äººæ•°</label>
      <div style="display:flex;gap:6px;align-items:center;">
        <input id="serv" type="number" min="1" step="1" style="width:80px;">
        <span>äººåˆ†</span>
      </div>

      <label>ææ–™ï¼ˆææ–™ï¼åˆ†é‡ï¼‰</label>
      <div id="ingredients"></div>
      <button type="button" onclick="addIngredient()">ï¼‹ææ–™è¿½åŠ </button>

      <label>ä½œã‚Šæ–¹</label>
      <div id="steps"></div>
      <button type="button" onclick="addStep()">ï¼‹å·¥ç¨‹è¿½åŠ </button>

      <button type="button" onclick="window.print()" style="margin-top:10px;">ğŸ–¨ å°åˆ·</button>
    </form>

  </div>

<script>
function addIngredient(name="", amount=""){
  const row=document.createElement("div");
  row.className="ing-row";

  const n=document.createElement("input");
  n.placeholder="ææ–™";
  n.value=name;
  n.oninput=update;

  const a=document.createElement("input");
  a.placeholder="åˆ†é‡";
  a.value=amount;
  a.oninput=update;

  const b=document.createElement("button");
  b.type="button";
  b.textContent="âˆ’";
  b.onclick=()=>{row.remove(); update();};

  row.append(n,a,b);
  ingredients.append(row);
}

function addStep(v=""){
  const d=document.createElement("div");
  d.className="step-input";

  const i=document.createElement("input");
  i.value=v;
  i.placeholder="å·¥ç¨‹ã‚’å…¥åŠ›";
  i.oninput=update;

  const b=document.createElement("button");
  b.type="button";
  b.textContent="âˆ’";
  b.onclick=()=>{d.remove(); update();};

  d.append(i,b);
  steps.append(d);
}

function autoShrinkSteps(){
  const wrap = document.querySelector(".steps-wrap");
  const list = document.getElementById("backSteps");
  if(!wrap || !list) return;

  let size = 11.5; // initial
  list.style.fontSize = size + "pt";

  const available = wrap.clientHeight - 4; // safety margin

  while(list.scrollHeight > available && size > 8.0){
    size -= 0.5;
    list.style.fontSize = size + "pt";
  }
}

function autoShrinkIngredients(){
  const wrap=document.getElementById("frontIngWrap");
  const head=wrap.querySelector(".ing-head");
  const sep=wrap.querySelector(".ing-sep");
  const table=document.getElementById("frontIngTable");

  let size=9.0;
  table.style.fontSize=size+"pt";

  const available = wrap.clientHeight - head.offsetHeight - sep.offsetHeight - 6; // safety margin

  while(table.scrollHeight > available && size > 6.0){
    size -= 0.5;
    table.style.fontSize = size + "pt";
  }
}

function update(){
  frontTitle.textContent = title.value || "ãƒ¬ã‚·ãƒ”ã‚¿ã‚¤ãƒˆãƒ«";
  frontServ.textContent  = serv.value ? (serv.value + "äººåˆ†") : "â—‹äººåˆ†";

  // ingredients table
  frontIngTable.innerHTML = "";
  [...ingredients.children].forEach(row=>{
    const inputs=row.querySelectorAll("input");
    const name = (inputs[0]?.value||"").trim();
    const amt  = (inputs[1]?.value||"").trim();
    if(!name && !amt) return;
    frontIngTable.insertAdjacentHTML("beforeend",
      `<tr><td class="ing-name">${escapeHtml(name)}</td><td class="ing-amount">${escapeHtml(amt)}</td></tr>`
    );
  });

  // steps
  backSteps.innerHTML = "";
  [...steps.querySelectorAll("input")].forEach((i,n)=>{
    const v=i.value.trim();
    if(!v) return;
    backSteps.insertAdjacentHTML("beforeend",
      `<li class="step-item"><div class="step-num">${n+1}</div><div>${escapeHtml(v)}</div></li>`
    );
  });

  autoShrinkIngredients();
  autoShrinkSteps();
}

function escapeHtml(str){
  return str.replace(/[&<>"']/g, (m) => ({
    "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"
  }[m]));
}

imgUp.onchange = (e) => {
  const f=e.target.files[0];
  if(!f) return;
  const r=new FileReader();
  r.onload = (ev) => {
    frontImg.src = ev.target.result;
    frontImg.style.display = "block";
    ph.style.display = "none";
  };
  r.readAsDataURL(f);
};

title.oninput = serv.oninput = update;

window.addEventListener("resize", () => {
  autoShrinkIngredients();
  autoShrinkSteps();
});

addIngredient(); addIngredient();
addStep(); addStep();
update();
</script>

</body>
</html>
